<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rat Pack - Final Report – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rat Pack - Final Report</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Authors</strong>: Thanh Dao, Valeriia Frolova, Aachal Grimire, Elijah Yong, Gracie Zheng<br>
<strong>Last Updated</strong>: December 18th, 2024 <span class="citation" data-cites="2:33PM">@2:33PM</span></p>
<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>This study investigates the relationship between various factors, including socioeconomic indicators and urban infrastructure, and rat populations in New York City. Our analysis reveals several key findings:</p>
<ul>
<li><strong>Effectiveness of Bait Programs</strong>: New York City’s Department of Health (DOH) bait programs have been effective in reducing rat sightings over time in regions like the Bronx but not effective in regions like Queens. There is a significant yearly correlation but insignificant monthly correlation.</li>
<li><strong>Limited Correlation with Socioeconomic Factors</strong>: We found little to no correlation between unemployment rates, median income, and rat sightings, suggesting that socioeconomic factors may not be the primary drivers of rat infestations.</li>
<li><strong>Impact of Outdoor Dining</strong>: There is a strong positive relationship between the increase in outdoor seating violations and rat infestations with restaurants with B&amp;C grades resulting in high rat population density.</li>
<li><strong>Impact of Urban Infrastructure</strong>: The presence of bins, while a potential source of food, does not necessarily equate to higher rat infestations. However, restaurants were found to have a direct impact on rat populations.</li>
<li><strong>Public Transportation and Rat Sightings</strong>: Public transportation locations were found to have little effect on rat sightings.</li>
</ul>
<p>These findings highlight the complex interplay of factors influencing rat populations in urban environments. Future research could delve deeper into the specific factors that contribute to rat infestations and explore more effective strategies for control and prevention.</p>
</section>
<section id="background" class="level1">
<h1>Background</h1>
<p>Rats in NYC are a notorious part of urban life, often associated with the city’s dense infrastructure and vast waste production. They live in sewers, subways, and parks, and have become a public health concern. Our team has taken interest in this issue, and we have chosen to research it further.</p>
</section>
<section id="overarching-question" class="level1">
<h1>Overarching Question</h1>
<p>To guide our research, we asked the following question: What influences the likelihood of rat infestations in NYC neighborhoods?</p>
<section id="specific-topics" class="level2">
<h2 class="anchored" data-anchor-id="specific-topics">Specific Topics</h2>
<p>To better answer our overarching question, we focused on the following topics:</p>
<ul>
<li>The effect of NYC DOH programs (<a href="https://thanhtdao922.github.io/STA9750-2024-FALL/individual_report.html">report</a>)</li>
<li>The effect of annual income and unemployment of a neighborhood (<a href="https://bleuuuz.github.io/STA9750-2024-FALL/Final%20Project%20Individual%20Report.html">report</a>)</li>
<li>The effect of restaurants (<a href="">report</a>)</li>
<li>The effect of food scrap drop-off sites (<a href="https://whaleron.github.io/STA9750-2024-FALL/mp05.html">report</a>)</li>
<li>The effect of NYC public transportation (<a href="">report</a>)</li>
</ul>
<p>The corresponding, in-depth programs are linked with each topic.</p>
</section>
</section>
<section id="data-used" class="level1">
<h1>Data Used</h1>
<p>To aid in our research, we choose to utilize data from <a href="https://www.nyc.gov/site/designcommission/resources/designing-ny/open-data.page">NYC Open Data</a>, a reliable and frequently updated data source. Specifically, we used the following:</p>
<ul>
<li><a href="https://data.cityofnewyork.us/Social-Services/Rat-Sightings/3q43-55fe/about_data">Rat sightings</a></li>
<li><a href="https://data.cityofnewyork.us/Health/Rodent-Inspection/p937-wjvj/about_data">Rodent inspection</a></li>
<li><a href="https://www.nyc.gov/site/doh/data/data-home.page">NYC Health</a></li>
<li><a href="https://data.cityofnewyork.us/Health/DOHMH-New-York-City-Restaurant-Inspection-Results/43nn-pn8j/data">Restaurant inspection results</a></li>
<li><a href="https://data.cityofnewyork.us/Environment/Food-Scrap-Drop-Off-Locations-Map/n5y5-3ud3">Food scrap drop-off locations</a></li>
<li><a href="https://data.ny.gov/Transportation/MTA-Subway-Stations/39hk-dx4f/about_data">MTA subway stations</a></li>
<li><a href="https://data.ny.gov/Transportation/MTA-Bus-Route-Segment-Speeds-Beginning-2023/58t6-89vi/about_data">MTA bus stops</a></li>
<li><a href="https://data.cccnewyork.org/data/map/66/median-incomes#66/39/3/107/127/a/a">NYC incomes</a></li>
</ul>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<p>Although the data used in our analysis was sourced from government agencies, it is not without limitations. One significant issue lies in the nature of certain data sets, such as those documenting rat sightings or inspections, which are prone to reporting and location-based biases. Since these data sets rely solely on reported incidents, the actual level of rat activity in an area may be underrepresented or over-represented, depending on the willingness or ability of residents to report sightings. As a result, the data may not provide a fully accurate depiction of rat infestations across the city.</p>
<p>Another limitation stems from the lack of contextual information within some data sets. For instance, certain data columns were non-descriptive or contained missing values, which hindered a deeper understanding of the underlying patterns. While we were able to mitigate this issue to some extent by cross-referencing with other data sources, it still posed challenges in ensuring comprehensive analysis.</p>
<p>Lastly, there was a notable absence of data directly from the MTA, a crucial factor in understanding the relationship between NYC’s public transportation system and rat activity. This gap forced us to extrapolate and make certain assumptions, which, while informed, may not fully capture the nuances of how transit systems contribute to or are affected by rat infestations.</p>
<p>Despite these challenges, the data sets we used remain highly valuable for identifying broad trends and forming initial insights. The limitations, while important to acknowledge, do not undermine the significance of the analysis they enabled.</p>
</section>
</section>
<section id="prior-work" class="level1">
<h1>Prior Work</h1>
<p><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC4157232/">Previous research</a> conducted by the <a href="https://www.downstate.edu/education-training/school-of-public-health/departments/epidemiology-biostatistics/index.html">Department of Epidemiology and Biostatistics at the State University of New York</a> has identified several factors associated with increased rat sightings in New York City. These factors include:</p>
<ul>
<li><strong>Proximity to public spaces</strong>: Areas with high foot traffic and easy access to food sources are more prone to rat infestations</li>
<li><strong>Vacant housing units</strong>: These properties can provide ideal breeding grounds for rats.</li>
<li><strong>Low education levels</strong>: Lower education levels may correlate with lower awareness of sanitation practices and increased risk of attracting rats.</li>
</ul>
<p>These findings suggest that targeted interventions, such as improved sanitation and maintenance of vacant properties, can help reduce rat populations in specific areas.</p>
<p><a href="https://www.nytimes.com/article/curbside-composting-brooklyn.html">NYC’s composting program</a> is a cornerstone of the city’s zero-waste goals, aiming to divert organic waste from landfills and reduce greenhouse gas emissions. The program initially began as a pilot project in select neighborhoods and has since expanded to include all five boroughs, with full implementation expected by 2025. This initiative is not without challenges. Public adoption remains inconsistent, and the effectiveness of composting infrastructure in densely populated neighborhoods is still under scrutiny.</p>
<p>Building on previous research, we also decided to use reported rat sightings as the closest proxy for actual rat populations. We aimed to expand upon prior findings by exploring additional factors like DOH bait programs, income and unemployment, restaurant density, presence of food scraps, and transit density.</p>
</section>
<section id="findings" class="level1">
<h1>Findings</h1>
<section id="nyc-doh" class="level2">
<h2 class="anchored" data-anchor-id="nyc-doh">NYC DOH</h2>
<p>We analyzed the impact of NYC DOH bait programs on rat sightings using data from OpenData, specifically focusing on rat sightings and rat inspections. The analysis uses a cause-and-effect approach, comparing the number of bait inspections in one year to rat sightings in the following year, and drawing conclusions based on a calculated correlation coefficient.</p>
<p>Overall, on a yearly basis, the data reveals a moderately strong correlation, suggesting that increased bait inspections are somewhat effective in reducing rat sightings. However, when examined on a monthly basis, no significant relationship was observed. This indicates that a monthly time frame may be too short to capture measurable effects.</p>
<p>Focusing instead on a yearly perspective across boroughs, the findings reveal that bait programs are highly effective in the Bronx, showing a strong correlation with reduced sightings. In contrast, no correlation was found in Queens, suggesting the programs may have little to no impact there.</p>
<p>The following are 2 sample figures created throughout this process, and display the correlation between bait inspections and next year’s sightings. To the left is the overall, while to the right is specifically for the Bronx. Further figures and analysis can be found in the NYC DOH report linked above.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="doh_photo.png" class="img-fluid figure-img"></p>
<figcaption>Figures for DOH Report</figcaption>
</figure>
</div>
<p>Overall, we can say that NYC DOH programs, specifically their bait initiative, is beneficial in decreasing the rat sightings in NYC on a yearly basis.</p>
</section>
<section id="income-and-unemployment" class="level2">
<h2 class="anchored" data-anchor-id="income-and-unemployment">Income and Unemployment</h2>
<p>We looked into the impact of socioeconomic factors on rat populations, more specifically how annual median income and unemployment rates influence rat sightings. To get a sense of this on a borough level, we created two plots that compared our variables to the number of rat sightings which both show little to no correlation between the two.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="borough_level.png" class="img-fluid figure-img"></p>
<figcaption>Figures for Income and Unemployment per Borough</figcaption>
</figure>
</div>
<p>The issue we originally faced is that it is hard to draw conclusions from just five data points and unemployment rates/annual median income are not equally distributed throughout boroughs. To remedy this, we broke down the city into community districts which showed the variation in income and unemployment per borough.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="borough_variation.png" class="img-fluid figure-img"></p>
<figcaption>Figures for Borough Variation</figcaption>
</figure>
</div>
<p>As we can see on the left, there are certain outliers like Williamsburg and the upper west side where the median income is vastly greater than other respective parts of Brooklyn and Manhattan. On the right, we can see that in terms of unemployment, there is a heavy concentration in the upper regions of Manhattan and across the Bronx.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="cdta_level.png" class="img-fluid figure-img"></p>
<figcaption>Figures for Income and Unemployment cdta</figcaption>
</figure>
</div>
<p>After taking a more granular look into communities and adding more data points, we still could not find any correlation between median income, unemployment rates and number of rat sightings. While removing outliers and running a correlation analysis, the correlation values are a 0.0085 between median income and rat sightings and 0.15 correlation between unemployment and rat sightings. Although there may be some minor relationship between unemployment and rat sightings, these findings suggest that other factors may play a more significant role in determining rat populations.</p>
</section>
<section id="restaurants" class="level2">
<h2 class="anchored" data-anchor-id="restaurants">Restaurants</h2>
</section>
<section id="food-drop-off-sites" class="level2">
<h2 class="anchored" data-anchor-id="food-drop-off-sites">Food Drop-Off Sites</h2>
<p>The findings of this analysis provide valuable insights into the relationship between food scrap drop-off sites and rat complaints in NYC, but they do not conclusively indicate that these sites are the direct cause of infestations.</p>
<p>Over the past five years, we observed a total of 98,141 rat complaints in proximity to food scrap locations, with an average of 773 complaints per ZIP code. A moderate correlation of 0.59 between the number of bins and complaints suggests a potential link, but this alone does not establish causation.</p>
<p>Seasonal trends reveal higher complaints during summer and early fall (June to October), likely driven by increased rodent activity in warmer months, while complaints drop significantly during the winter.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="top_monthly.png" class="img-fluid figure-img"></p>
<figcaption>Figures for Top Monthly Complaints Zip Codes</figcaption>
</figure>
</div>
<p>Year-to-year fluctuations show peaks in specific years, particularly in areas with frequent complaints, reflecting broader patterns that may be influenced by external factors.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="top_zips_last5years.png" class="img-fluid figure-img"></p>
<figcaption>Figures for Top 3 Most Complained Zips by Years</figcaption>
</figure>
</div>
<p>Importantly, the analysis highlights that the presence of bins does not always equate to higher infestations. ZIP codes with only one food scrap bin, such as those with a high complaints-to-bin ratio, demonstrate that factors beyond infrastructure—such as population density, socioeconomic conditions, and improper usage—also play a role.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="one-bin_most complaints.png" class="img-fluid figure-img"></p>
<figcaption>Figures for Top Complaints Per Site</figcaption>
</figure>
</div>
<p>Proper disposal methods, securely closed bins, and community compliance are crucial to ensuring the success of this initiative. With the program expanding and bins increasingly installed across the city, the responsibility largely falls on residents to follow proper usage guidelines. This is particularly relevant as mandatory composting rules and fines will take effect in spring 2025, making compliance a critical component of addressing current challenges.</p>
<p>Further analysis is needed to fully understand the interplay of factors influencing rodent activity near food scrap locations. Socioeconomic dynamics, pedestrian traffic in busy neighborhoods, and bin design (e.g., metal vs.&nbsp;plastic) should be explored to develop more targeted interventions. As the initiative grows, tracking the effects of new rules and public adherence on rat complaints will provide valuable insights into its overall impact. These findings establish a foundation for ongoing evaluation and highlight the importance of a multifaceted approach to managing urban sustainability challenges.</p>
</section>
<section id="public-transportation" class="level2">
<h2 class="anchored" data-anchor-id="public-transportation">Public Transportation</h2>
</section>
</section>
<section id="next-steps" class="level1">
<h1>Next Steps</h1>
<p>For future work, we propose several key steps to deepen our understanding and improve outcomes. First, conducting public surveys will be critical to gather direct feedback and insights from residents. These surveys can help uncover nuanced perspectives on how rat infestations are impacting communities, as well as highlight gaps in current efforts. Second, prioritizing the collection of more detailed and accurate data is essential. By refining data sources and methods, we can better identify the underlying factors driving infestations, enabling more targeted interventions.</p>
<p>Third, it is important to examine the role of public behavior and policies in shaping outcomes. This includes assessing which practices have been effective and identifying areas where adjustments are needed. Understanding the interplay between community actions and policy measures will provide valuable lessons on what works and why. Lastly, comparing NYC’s approach to pest control with those of other cities can help us identify successful strategies and best practices that could be adapted to local conditions. Learning from cities that have effectively managed similar challenges can inspire innovative solutions tailored to NYC’s unique context.</p>
<p>By following these steps, we can build a more comprehensive understanding of the issue and develop informed, data-driven strategies to combat rat infestations more effectively.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/thanhtdao922\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>